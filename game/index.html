<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- jquery CDN uncompressed 불러오기 -->
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/script.js"></script>
  <title>index</title>
</head>
<body>
  <!-- .container -->
  <div class="container">
      <div class="background"></div>
      <img id="mario" src="assets/mario.gif" alt="mario">
      <img id="goomba" src="assets/goomba.gif" alt="goomba">
      <img id="killer" src="assets/killer.jpg" alt="killer">
      <div id="score">점수 : 0</div>
    
  </div>
  
  <script>
    //점프 상태
    let isJumping = false;
    let isGameOver = false;
    let score = 0;
    let isKillerStart = false;
  
    //굼바 죽는 것
    function goombaDown() {
      let goombaLeft = Number($('#goomba').css('left').replace('px',''));
      let  killerRight = Number($('#killer').css('left').replace('px','')) + 150;

      if (isKillerStart && goombaLeft <= killerRight) {
        score += 200;
        setScore(score);

        killerInit();
        //킬러 없애고
        $('#killer').stop().hide();
        $('#goomba').stop().hide();
        goombaInit();
        setTimeout(goombaStart,getRandomInt(500,1000));
      }
    }

    //마리오와 굼바 충돌
    function marioDown() {
      if (isGameOver) {
        return;
      }
      //let top = Number($('#mario').css('top').replace('px',''));
      //let bottom = top + CHARACTER_HEIGHT;
      //let marioLeft = Number($('#mario').css('left').replace('px',''));
      let marioRight = 230;

      let goombaLeft = Number($('#goomba').css('left').replace('px',''));
      //let goombaRight = goombaLeft + 100;

      if(goombaLeft <= marioRight && isJumping == false) {
        //console.log('die');
        //alert("Game Over");
        $('#goomba').stop();
        isGameOver = true;
      }
      
    }
    //랜덤 함수
    function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min)) + min; //최댓값은 제외, 최솟값은 포함
    }

    //킬러 (미사일) 쏘기
    function killerStart() {
      if (isKillerStart) {
        return;
      }
      isKillerStart = true;
      $('#killer').show().animate( {left: '2000px'}, 1000, function() {
        //원래 자리로 돌아옴
        $('#killer').css('left','200px').hide();
      });
      isKillerStart = false;
    }

    function killerInit() {
      $('#killer').css('left', '200px').stop().hide();
    }
      
    //굼바가 오른쪽에서 나와서 왼쪽 끝으로 사라지게 만든다
    function goombaStart() {
      let speed = getRandomInt(1000,2000);
      let respawnTime = getRandomInt(1000,2000);


      $('#goomba').animate( {left: '-120px'}, speed, function() {
        //마리오가 살았으면 점수 +100
        if (isGameOver == false) {
          score += 100;
          setScore();
        }
        //왼쪽 끝까지 가면 초기 위치로 이동
       goombaInit();

        //1초 후에 나오기
        setTimeout(goombaStart(), respawnTime);
      });
    }

    // 점수 계산
    function setScore() {
      $('#score').text(`점수 : ${score}`);
    }


    //굼바 자기자리로
    function goombaInit() {
      $('#goomba').css('right','-150px').css('left','');
    }

    //jump
    function jump() {
      //연타 방지
      if (isJumping) {
        return;
      }
      isJumping = true;
        $("#mario").animate( {bottom: '+=200px'}).animate( {bottom: '-=200px'}, 1000, function() {
          isJumping = false;
        })
    };


    // onload
    //스페이스바 누르면 점프
    $(function() {
      $('body').keydown(function(event) {
        switch (event.key) {
          case ' ':
            jump();
            break;
          
          case 'Control':
            killerStart();
            break;
        }
      });
    });

    //굼바 출발
    goombaStart();
    //충돌 체크
    setInterval(marioDown, 10); //60frame
    //굼바 죽었나 체크
    setInterval(goombaDown,10);

  </script>
</body>
</html>